---

# Below is an example which installs a few services on the host, in different configuration.
# You should tweak this example as you see fit and enable the services that you need.

########################################################################
#                                                                      #
# Playbook                                                             #
#                                                                      #
########################################################################

# Put a strong secret below, generated with `pwgen -s 64 1` or in another way
# Various other secrets will be derived from this secret automatically.
mash_playbook_generic_secret_key: "{{ vault_mash_playbook_generic_secret_key }}"

########################################################################
#                                                                      #
# /Playbook                                                            #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# systemd_service_manager                                              #
#                                                                      #
########################################################################

# Allow extra time for slow services to start before verification.
devture_systemd_service_manager_up_verification_delay_seconds: 25

########################################################################
#                                                                      #
# /systemd_service_manager                                             #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# system                                                               #
#                                                                      #
########################################################################

# SSH

system_security_ssh_enabled: true

system_security_ssh_services: ['ssh']

system_security_ssh_port: "{{ ansible_ssh_port }}"

system_security_ssh_authorizedkeys_host: ["{{ ssh_key_1 }}", "{{ ssh_key_2 }}"]  # list of authorized public keys
system_security_ssh_unauthorizedkeys_host: []  # list of unauthorized/revoked public keys
system_security_ssh_allow_tcp_forwarding: true
# /SSH


# fail2ban
system_security_fail2ban_enabled: true

system_security_fail2ban_sshd_port: "{{ system_security_ssh_port }}"
# If you enabled playbook-managed ssh as described above,
# you can replace the line above with the following:
# system_security_fail2ban_sshd_port: "{{ system_security_ssh_port }}"

# /fail2ban

########################################################################
#                                                                      #
# /system                                                              #
#                                                                      #
########################################################################


########################################################################
#                                                                      #
# Docker                                                               #
#                                                                      #
########################################################################

# To disable Docker installation (in case you'd be installing Docker in another way),
# remove the line below.
mash_playbook_docker_installation_enabled: true

# To disable Docker SDK for Python installation (in case you'd be installing the SDK in another way),
# remove the line below.
devture_docker_sdk_for_python_installation_enabled: true

devture_systemd_docker_base_ipv6_enabled: true

mash_playbook_docker_installation_daemon_options_custom:
  default-address-pools:
    - base: "172.16.0.0/16"
      size: 25
    - base: "192.168.2.0/23"
      size: 25
    - base: "192.168.4.0/22"
      size: 25
    - base: "192.168.8.0/21"
      size: 25
    - base: "192.168.16.0/20"
      size: 25
    - base: "192.168.32.0/19"
      size: 25
    - base: "192.168.64.0/18"
      size: 25
  dns:
    - "10.1.154.10"
  registry-mirrors:
    - "https://mirror.gcr.io"

########################################################################
#                                                                      #
# /Docker                                                              #
#                                                                      #
########################################################################


########################################################################
#                                                                      #
# com.devture.ansible.role.timesync                                    #
#                                                                      #
########################################################################

# To ensure the server's clock is synchronized (using systemd-timesyncd/ntpd),
# we enable the timesync service.

devture_timesync_installation_enabled: false

########################################################################
#                                                                      #
# /com.devture.ansible.role.timesync                                   #
#                                                                      #
########################################################################


########################################################################
#                                                                      #
# devture-traefik                                                      #
#                                                                      #
########################################################################

# Most services require a reverse-proxy, so we enable Traefik here.
#
# Learn more about the Traefik service in docs/services/traefik.md

# mash_playbook_reverse_proxy_type: playbook-managed-traefik

# The email address that Traefik will pass to Let's Encrypt when obtaining SSL certificates
# traefik_config_certificatesResolvers_acme_email: your-email@example.com

# Or, if you'd like to install Traefik yourself:
#
mash_playbook_reverse_proxy_type: other-traefik-container
mash_playbook_reverse_proxyable_services_additional_network: traefik

# Recommended for Immich to allow long-running uploads over slow links.
traefik_config_entrypoint_web_transport_respondingTimeouts_readTimeout: 1800s  # noqa var-naming
traefik_config_entrypoint_web_transport_respondingTimeouts_writeTimeout: 1800s  # noqa var-naming
traefik_config_entrypoint_web_transport_respondingTimeouts_idleTimeout: 1800s  # noqa var-naming


########################################################################
#                                                                      #
# /devture-traefik                                                     #
#                                                                      #
########################################################################


########################################################################
#                                                                      #
# devture-postgres                                                     #
#                                                                      #
########################################################################

# Most services require a Postgres database, so we enable Postgres here.
#
# Learn more about the Postgres service in docs/services/postgres.md

postgres_enabled: true

# Put a strong password below, generated with `pwgen -s 64 1` or in another way
postgres_connection_password: "{{ vault_devture_postgres_connection_password }}"

########################################################################
#                                                                      #
# /devture-postgres                                                    #
#                                                                      #
########################################################################


########################################################################
#                                                                      #
# uptime-kuma                                                          #
#                                                                      #
########################################################################

# Learn more about the Uptime-kuma service in docs/services/uptime-kuma.md
#
# This service is only here as an example. If you don't wish to use the
# Uptime-kuma service, remove the whole section.

# uptime_kuma_enabled: true

# uptime_kuma_hostname: uptime-kuma.example.com

# For now, hosting uptime-kuma under a path is not supported.
# See: https://github.com/louislam/uptime-kuma/issues/147
# uptime_kuma_path_prefix: /uptime-kuma

########################################################################
#                                                                      #
# /uptime-kuma                                                         #
#                                                                      #
########################################################################


# You can add additional services here, as you see fit.
# To discover new services and configuration, see docs/supported-services.md

########################################################################
#                                                                      #
# nextcloud                                                            #
#                                                                      #
########################################################################

nextcloud_enabled: true

nextcloud_hostname: "nextcloud.{{ domain }}"
nextcloud_path_prefix: /

nextcloud_app_collabora_wopi_url: "{{ collabora_online_url }}"

# By default, various private IPv4 networks are whitelited to connect to the WOPI API (document serving API).
# If your Collabora Online installation does not live on the same server as Nextcloud,
# you may need to adjust the list of networks.
# If necessary, redefined the `nextcloud_collabora_app_wopi_allowlist` environment variable here.

# https://docs.nextcloud.com/server/stable/admin_manual/configuration_server/config_sample_php_parameters.html
# https://github.com/mother-of-all-self-hosting/ansible-role-nextcloud/blob/main/defaults/main.yml

# Nextcloud dedicated valkey
# Point Nextcloud to its dedicated Valkey instance
nextcloud_redis_hostname: mash-nextcloud-valkey

# Ensure Nextcloud starts after Valkey
nextcloud_systemd_required_services_list_custom:
  - "mash-nextcloud-valkey.service"

# Connect Nextcloud to Valkey's container network
nextcloud_container_additional_networks_custom:
  - "mash-nextcloud-valkey"
# /Nextcloud dedicated valkey

nextcloud_preview_enabled: true

nextcloud_environment_variables_additional_variables: |
  PHP_MEMORY_LIMIT=2048M

nextcloud_config_parameter_default_phone_region: DK
nextcloud_config_parameter_default_timezone: Europe/Copenhagen
nextcloud_config_parameter_maintenance_window_start: 3

nextcloud_config_parameters_custom:
  - key: mail_smtpmode
    value: "{{ vault_mail_smtp_mode }}"
    type: string
  - key: mail_sendmailmode
    value: "{{ vault_mail_smtp_mode }}"
    type: string
  - key: mail_from_address
    value: "{{ vault_mail_smtp_address }}"
    type: string
  - key: mail_domain
    value: "{{ domain }}"
    type: string
  - key: mail_smtphost
    value: "{{ vault_mail_smtp_host }}"
    type: string
  - key: mail_smtpport
    value: "{{ vault_mail_smtp_port | int }}"
    type: integer
  - key: mail_smtpsecure
    value: "{{ vault_mail_smtp_secure }}"
    type: string
  - key: mail_smtpauth
    value: 1
    type: integer
  - key: mail_smtpname
    value: "{{ vault_mail_smtp_address }}@{{ domain }}"
    type: string
  - key: mail_smtppassword
    value: "{{ vault_mail_smtp_password }}"
    type: string
  - key: mail_smtpauthtype
    value: "LOGIN"
    type: string

# Specify the maximum size of the preview in pixels
nextcloud_preview_preview_max_x: "2048"
nextcloud_preview_preview_max_y: "2048"

# Specify JPEG quality for preview images
nextcloud_preview_app_jpeg_quality: 85

########################################################################
#                                                                      #
# /nextcloud                                                           #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# collabora-online                                                     #
#                                                                      #
########################################################################

collabora_online_enabled: true

collabora_online_hostname: "collabora.{{ domain }}"

# A password for the admin interface, available at: https://COLLABORA_ONLINE_DOMAIN/browser/dist/admin/admin.html
collabora_online_environment_variable_password: "{{ vault_collabora_online_env_variable_password }}"

collabora_online_environment_variable_aliasgroup1: "https://{{ nextcloud_hostname | replace('.', '\\.') }}:443"

########################################################################
#                                                                      #
# /collabora-online                                                    #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# forgejo                                                              #
#                                                                      #
########################################################################

forgejo_enabled: true

forgejo_hostname: "git.{{ domain }}"
# forgejo_path_prefix: /forgejo

########################################################################
#                                                                      #
# /forgejo                                                             #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# gitea                                                                #
#                                                                      #
########################################################################

gitea_enabled: false

# Gitea uses port 22 by default.
# We recommend that you move your regular SSH server to another port,
# and stick to this default.
#
# If you wish to use another port, uncomment the variable below
# and adjust the port as you see fit.
# gitea_ssh_port: 222

gitea_hostname: "gitea.{{ domain }}"
# gitea_path_prefix: /gitea

########################################################################
#                                                                      #
# /gitea                                                               #
#                                                                      #
########################################################################


########################################################################
#                                                                      #
# miniflux                                                             #
#                                                                      #
########################################################################

# Learn more about the Miniflux service in docs/services/miniflux.md
#
# This service is only here as an example. If you don't wish to use the
# Miniflux service, remove the whole section.

miniflux_enabled: false

miniflux_hostname: "rss.{{ domain }}"
# miniflux_path_prefix: /miniflux

miniflux_admin_login: Tray2941
miniflux_admin_password: "{{ vault_miniflux_admin_password }}"

########################################################################
#                                                                      #
# /miniflux                                                            #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# adguard-home                                                         #
#                                                                      #
########################################################################

adguard_home_enabled: true

adguard_home_hostname: "dns.{{ domain }}"

# Hosting under a subpath sort of works, but is not ideal
# (see the URL section below for details).
# Consider using a dedicated hostname and removing the line below.

# adguard_home_path_prefix: /adguard-home

# Expose only on 192.168.1.15
adguard_home_container_dns_tcp_bind_port: '10.1.154.11:53'
adguard_home_container_dns_udp_bind_port: '10.1.154.11:53'

########################################################################
#                                                                      #
# /adguard-home                                                        #
#                                                                      #
########################################################################


########################################################################
#                                                                      #
# netbox                                                               #
#                                                                      #
########################################################################

netbox_enabled: false

netbox_hostname: "ipam.{{ domain }}"
# netbox_path_prefix: /netbox

# Put a strong secret below, generated with `pwgen -s 64 1` or in another way
netbox_environment_variable_secret_key: ''

# The following superuser will be created upon launch.
netbox_environment_variable_superuser_name: your_username_here
netbox_environment_variable_superuser_email: your.email@example.com
# Put a strong secret below, generated with `pwgen -s 64 1` or in another way.
# Changing the password subsequently will not affect the user's password.
netbox_environment_variable_superuser_password: ''

# Redis configuration, as described below

########################################################################
#                                                                      #
# /netbox                                                              #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# freshrss                                                             #
#                                                                      #
########################################################################

freshrss_enabled: true

freshrss_hostname: "rss.{{ domain }}"
# freshrss_path_prefix: /freshrss

# Put a strong password below, generated with `pwgen -s 64 1` or in another way.
# You will need to use this password in the setup wizard after installation.
freshrss_database_password: "{{ vault_freshrss_database_password }}"
freshrss_database_type: postgres

########################################################################
#                                                                      #
# /freshrss                                                            #
#                                                                      #
########################################################################


########################################################################
#                                                                      #
# hubsite                                                              #
#                                                                      #
########################################################################

hubsite_enabled: true

hubsite_hostname: "hub.{{ domain }}"

hubsite_title: "We bring you..."
hubsite_subtitle: "These wonderful services!"

# Protect Hubsite with Authentik forward-auth (configured in Traefik file provider).
hubsite_container_labels_additional_labels_custom:
  - "traefik.http.routers.{{ hubsite_identifier }}.middlewares=authentik-forwardauth@file"

# If you want to explicitly control which services you want to show on this page you can overwrite

# hubsite_service_list_auto: |
#   {{
#     ([{'name': 'Miniflux', 'url': hubsite_service_miniflux_url, 'logo_location': 'assets/miniflux.png', 'description': 'An opinionated feed reader', 'priority': hubsite_service_miniflux_priority}] if hubsite_service_miniflux_enabled else [])
#     +
#     ([{'name': 'Uptime Kuma', 'url': hubsite_service_uptime_kuma_url, 'logo_location': 'assets/uptime-kuma.png', 'description': 'Check the status of the services', 'priority': hubsite_service_uptime_kuma_priority}] if hubsite_service_uptime_kuma_enabled else [])
#     +
#     ([{'name': 'Uptime Kuma', 'url': hubsite_service_uptime_kuma_url, 'logo_location': 'assets/uptime-kuma.png', 'description': 'Check the status of the services', 'priority': hubsite_service_uptime_kuma_priority}] if hubsite_service_uptime_kuma_enabled else [])
#
#   }}

# Use the `hubsite_service_list_additional` variable to add services that are not provided by this playbook
hubsite_service_list_additional: |
  {%- set mash_mdad_services =
    ([{
      'name': 'BentoPDF',
      'url': 'https://' ~ bentopdf_hostname ~ bentopdf_path_prefix,
      'logo_location': 'assets/stirling-pdf.png',
      'description': 'Convert webpages into PDFs',
      'priority': 1100,
    }] if bentopdf_enabled else [])
    +
    ([{
      'name': 'CodiMD',
      'url': codimd_scheme ~ '://' ~ codimd_hostname ~ codimd_path_prefix,
      'logo_location': 'assets/docs.png',
      'description': 'Collaborative markdown notes',
      'priority': 1100,
    }] if codimd_enabled else [])
    +
    ([{
      'name': 'Collabora Online',
      'url': collabora_online_scheme ~ '://' ~ collabora_online_hostname ~ collabora_online_path_prefix,
      'logo_location': 'assets/docs.png',
      'description': 'Online office suite integration',
      'priority': 1100,
    }] if collabora_online_enabled else [])
    +
    ([{
      'name': 'ConvertX',
      'url': convertx_scheme ~ '://' ~ convertx_hostname ~ convertx_path_prefix,
      'logo_location': 'assets/docs.png',
      'description': 'Document and media conversion tools',
      'priority': 1100,
    }] if convertx_enabled else [])
    +
    ([{
      'name': 'CyberChef',
      'url': cyberchef_scheme ~ '://' ~ cyberchef_hostname ~ cyberchef_path_prefix,
      'logo_location': 'assets/docs.png',
      'description': 'Data transformation and encoding toolkit',
      'priority': 1100,
    }] if cyberchef_enabled else [])
    +
    ([{
      'name': 'Headplane',
      'url': 'https://' ~ headplane_hostname ~ headplane_path_prefix,
      'logo_location': 'assets/wireguard_easy.png',
      'description': 'Headscale administration UI',
      'priority': 1100,
    }] if headplane_enabled else [])
    +
    ([{
      'name': 'Immich',
      'url': immich_scheme ~ '://' ~ immich_hostname ~ immich_path_prefix,
      'logo_location': 'assets/docs.png',
      'description': 'Photo and video management',
      'priority': 1100,
    }] if immich_enabled else [])
    +
    ([{
      'name': 'Jellyfin',
      'url': 'https://' ~ jellyfin_hostname ~ jellyfin_path_prefix,
      'logo_location': 'assets/docs.png',
      'description': 'Media server and streaming',
      'priority': 1100,
    }] if jellyfin_enabled else [])
    +
    ([{
      'name': 'Neko',
      'url': 'https://' ~ neko_hostname ~ neko_path_prefix,
      'logo_location': 'assets/docs.png',
      'description': 'Shared browser and collaborative sessions',
      'priority': 1100,
    }] if neko_enabled else [])
    +
    ([{
      'name': 'qBittorrent',
      'url': 'https://' ~ qbittorrent_hostname ~ qbittorrent_path_prefix,
      'logo_location': 'assets/docs.png',
      'description': 'Torrent management web UI',
      'priority': 1100,
    }] if qbittorrent_enabled else [])
    +
    ([{
      'name': 'SFTPGo',
      'url': sftpgo_scheme ~ '://' ~ sftpgo_hostname ~ sftpgo_path_prefix,
      'logo_location': 'assets/docs.png',
      'description': 'Managed SFTP/FTP service',
      'priority': 1100,
    }] if sftpgo_enabled else [])
    +
    ([{
      'name': 'YaCy',
      'url': yacy_scheme ~ '://' ~ yacy_hostname ~ yacy_path_prefix,
      'logo_location': 'assets/docs.png',
      'description': 'Decentralized search engine',
      'priority': 1100,
    }] if yacy_enabled else [])
    +
    ([{
      'name': 'Element Web',
      'url': 'https://element.' ~ domain ~ '/',
      'logo_location': 'assets/element.png',
      'description': 'Matrix client web app',
      'priority': 1200,
    }])
    +
    ([{
      'name': 'Matrix.to',
      'url': 'https://mt.' ~ domain ~ '/',
      'logo_location': 'assets/docs.png',
      'description': 'Matrix permalink resolver',
      'priority': 1200,
    }])
    +
    ([{
      'name': 'Synapse Admin',
      'url': 'https://matrix.' ~ domain ~ '/synapse-admin',
      'logo_location': 'assets/docs.png',
      'description': 'Matrix homeserver administration',
      'priority': 1200,
    }])
    +
    ([{
      'name': 'Grafana',
      'url': 'https://stats.' ~ domain ~ '/',
      'logo_location': 'assets/grafana.png',
      'description': 'Metrics dashboards',
      'priority': 1200,
    }])
    +
    ([{
      'name': 'Traefik Dashboard',
      'url': 'https://matrix.' ~ domain ~ '/dashboard/',
      'logo_location': 'assets/docs.png',
      'description': 'Reverse proxy operational dashboard',
      'priority': 1200,
    }])
  -%}
  {{
    mash_mdad_services
    | rejectattr('name', 'in', (hubsite_service_list_auto | map(attribute='name') | list))
    | list
  }}


########################################################################
#                                                                      #
# /hubsite                                                             #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# bentopdf                                                             #
#                                                                      #
########################################################################

bentopdf_enabled: true

bentopdf_hostname: "pdf.{{ domain }}"

########################################################################
#                                                                      #
# /bentopdf                                                            #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# radicle_node                                                         #
#                                                                      #
########################################################################

radicle_node_enabled: true

radicle_node_hostname: "seed.{{ domain }}"

radicle_node_config_rad_passphrase: "{{ vault_radicle_node_config_rad_passphrase }}"

radicle_node_config_seedingpolicy_default: block

radicle_node_container_node_host_bind_port: ""

########################################################################
#                                                                      #
# /radicle_node                                                        #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# radicle_httpd                                                        #
#                                                                      #
########################################################################

radicle_httpd_enabled: true

radicle_httpd_hostname: "{{ radicle_node_hostname }}"

########################################################################
#                                                                      #
# /radicle_httpd                                                       #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# radicle_explorer                                                     #
#                                                                      #
########################################################################

radicle_explorer_enabled: true

radicle_explorer_hostname: "explorer.{{ domain }}"

########################################################################
#                                                                      #
# /radicle_explorer                                                    #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# authentik                                                            #
#                                                                      #
########################################################################

authentik_enabled: true

authentik_hostname: "authentik.{{ domain }}"

# Put a strong secret below, generated with `pwgen -s 64 1` or in another way
authentik_secret_key: "{{ authentik_secret_key_vault }}"

## Mailing
authentik_email_host: "{{ vault_mail_smtp_host }}"
authentik_email_port: "{{ vault_mail_smtp_port }}"
authentik_email_username: "{{ vault_mail_smtp_address }}@{{ domain }}"
authentik_email_password: "{{ vault_mail_smtp_password }}"
authentik_email_use_tls: "{{ vault_mail_smtp_tls }}"
authentik_email_use_ssl: "{{ vault_mail_smtp_ssl }}"
authentik_email_from: "{{ vault_mail_smtp_address }}@{{ domain }}"

########################################################################
#                                                                      #
# /authentik                                                           #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# tandoor                                                              #
#                                                                      #
########################################################################

tandoor_enabled: true

tandoor_hostname: "recipe.{{ domain }}"

tandoor_authentik_application_slug: tandoor

tandoor_socialaccount_providers:
  openid_connect:
    APPS:
      - provider_id: authentik
        name: Authentik
        client_id: "{{ vault_tandoor_oidc_client_id }}"
        secret: "{{ vault_tandoor_oidc_client_secret }}"
        settings:
          server_url: "https://authentik.{{ domain }}/application/o/{{ tandoor_authentik_application_slug }}/.well-known/openid-configuration"
          oauth_pkce_enabled: true

tandoor_container_additional_environment_variables: |
  {% set env_lines = [
    'SOCIAL_PROVIDERS=allauth.socialaccount.providers.openid_connect',
    'SOCIALACCOUNT_PROVIDERS=' ~ (tandoor_socialaccount_providers | to_json),
    'PROXY_HEADER=X-Forwarded-Proto'
  ] %}
  {%- for line in env_lines %}
  {{ line }}
  {% endfor %}

tandoor_systemd_required_services_list_custom:
  - mash-authentik-server.service
  - mash-authentik-worker.service

# tandoor_path_prefix: /


########################################################################
#                                                                      #
# /tandoor                                                             #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# owncast                                                              #
#                                                                      #
########################################################################

owncast_enabled: true

owncast_hostname: "live.{{ domain }}"

owncast_container_rtmp_host_bind_port: "10.1.154.10:1935"


########################################################################
#                                                                      #
# /owncast                                                             #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# headscale                                                            #
#                                                                      #
########################################################################
# https://github.com/mother-of-all-self-hosting/ansible-role-headscale/blob/main/defaults/main.yml

headscale_enabled: true

headscale_hostname: "headscale.{{ domain }}"

headscale_config_dns_nameservers_split:
  int.thewrt.com:
    - 10.1.10.2

headscale_config_dns_search_domains:
  - int.{{ domain }}

headscale_config_prefixes_v4: 100.100.0.0/20

headscale_configuration_extension:
  oidc:
    only_start_if_oidc_is_available: true
    issuer: "https://authentik.{{ domain }}/application/o/headscale/"
    client_id: "{{ vault_headscale_client_id }}"
    client_secret: "{{ vault_headscale_client_secret }}"
    scope: ["openid", "profile", "email"]
    pkce:
      enabled: true
      method: S256

headscale_systemd_required_services_list_custom:
  - mash-authentik-server.service
  - mash-authentik-worker.service
# https://headscale.net/stable/ref/oidc/?h=oidc

########################################################################
#                                                                      #
# /headscale                                                           #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# headplane                                                            #
#                                                                      #
########################################################################

headplane_enabled: true

headplane_hostname: "headplane.{{ domain }}"
headplane_cookie_secret: "{{ vault_headplane_cookie_secret }}"

headscale_extra_records_path_enabled: true
headplane_headscale_config_path_mount_options: readwrite
headscale_config_policy_mode: database

########################################################################
#                                                                      #
# /headplane                                                           #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# neko                                                                 #
#                                                                      #
########################################################################

neko_enabled: true
neko_hostname: "neko.{{ domain }}"

neko_environment_variables_neko_member_multiuser_admin_password: "{{ vault_neko_admin_pw }}"
neko_environment_variables_neko_member_multiuser_user_password: "{{ vault_neko_user_pw }}"

########################################################################
#                                                                      #
# /neko                                                                #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# convertx                                                             #
#                                                                      #
########################################################################

convertx_enabled: true

convertx_hostname: "convert.{{ domain }}"
convertx_environment_variables_webroot: /
convertx_environment_variables_account_registration: true
convertx_container_labels_additional_labels_custom:
  - "traefik.http.routers.mash-convertx.middlewares={{ (['authentik-forwardauth@file'] + (['mash-convertx-slashless-redirect', 'mash-convertx-strip-prefix'] if convertx_container_labels_traefik_path_prefix != '/' else []) + (['mash-convertx-add-request-headers'] if ((convertx_container_labels_traefik_additional_request_headers | default({}) | length) > 0) else []) + (['mash-convertx-add-response-headers'] if ((convertx_container_labels_traefik_additional_response_headers | default({}) | length) > 0) else [])) | unique | join(',') }}"

########################################################################
#                                                                      #
# /convertx                                                            #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# jellyfin                                                             #
#                                                                      #
########################################################################

jellyfin_enabled: true
jellyfin_hostname: "jellyfin.{{ domain }}"
jellyfin_container_additional_volumes:
  - type: bind
    src: /mash/media/movies
    dst: /movies

  - type: bind
    src: /mash/media/anime
    dst: /anime
    options: readonly

  - type: bind
    src: /mash/media/series
    dst: /series
    options: readonly
########################################################################
#                                                                      #
# /jellyfin                                                            #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# qbittorrent                                                          #
#                                                                      #
########################################################################

qbittorrent_enabled: true

qbittorrent_hostname: "bittorrent.{{ domain }}"

# The path where downloaded files will be stored on the host system
qbittorrent_download_path: "{{ qbittorrent_base_path }}/downloads"

# The path at which qbittorrent_download_path is mounted to inside the container
qbittorrent_download_bind_path: "/downloads"

# The port qBittorrent is listening for torrents on inside the container
qbittorrent_container_torrenting_port: 6881

# Controls whether the container exposes its torrenting port
# To become an "active node" you'll want to set this and configure port-forwarding in your router
qbittorrent_container_torrenting_bind_port: "{{ qbittorrent_container_torrenting_port }}"

########################################################################
#                                                                      #
# /qbittorrent                                                         #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# promtail                                                             #
#                                                                      #
########################################################################

promtail_enabled: false

# See "Configuring scrapers" below.
# You need to enable at least one scraper to have Promtail do anything.

# If you haven't enabled Grafana Loki on the same server, you will need
# to define some clients to push logs to.
# See "Configuring clients" below.

########################################################################
#                                                                      #
# /promtail                                                            #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# yacy                                                                 #
#                                                                      #
########################################################################

yacy_enabled: true

yacy_hostname: "yacy.{{ domain }}"
# yacy_path_prefix: /yacy
yacy_conf_password: "{{ vault_yacy_conf_password }}"

########################################################################
#                                                                      #
# /yacy                                                                #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# sftpgo                                                               #
#                                                                      #
########################################################################

sftpgo_enabled: true

sftpgo_hostname: "ftp.{{ domain }}"
sftpgo_environment_variables_httpd_bindings_0_enable_web_admin: true
sftpgo_environment_variables_data_provider_create_default_admin: true
sftpgo_environment_variables_sftpgo_default_admin_username: "{{ vault_sftpgo_default_admin_username }}"
sftpgo_environment_variables_sftpgo_default_admin_password: "{{ vault_sftpgo_default_admin_password }}"

########################################################################
#                                                                      #
# /sftpgo                                                              #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# codimd                                                               #
#                                                                      #
########################################################################

codimd_enabled: true

codimd_hostname: "codimd.{{ domain }}"
codimd_database_type: postgres

########################################################################
#                                                                      #
# /codimd                                                              #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# cyberchef                                                            #
#                                                                      #
########################################################################

cyberchef_enabled: true

cyberchef_hostname: "cyberchef.{{ domain }}"

########################################################################
#                                                                      #
# /cyberchef                                                           #
#                                                                      #
########################################################################

########################################################################
#                                                                      #
# immich                                                               #
#                                                                      #
########################################################################

immich_enabled: true

immich_hostname: "immich.{{ domain }}"

# Point to dedicated Immich dependencies host (`*-immich-deps`)
immich_redis_hostname: mash-immich-valkey

# Make Immich/Server start after dedicated Valkey/Postgres services
immich_server_systemd_required_services_list_custom:
  - "mash-immich-valkey.service"
  - "mash-immich-postgres.service"

# Connect Immich/Server container to dedicated dependency networks
immich_server_container_additional_networks_custom:
  - "mash-immich-valkey"
  - "mash-immich-postgres"

immich_database_hostname: mash-immich-postgres
immich_database_port: 5432

# Must match `inventory/host_vars/domain-immich-deps/vars.yml` before remote apply
immich_database_password: "{{ vault_immich_database_password }}"
immich_database_sslmode: disable

immich_server_environment_variable_immich_allow_setup: false

########################################################################
#                                                                      #
# /immich                                                              #
#                                                                      #
########################################################################
