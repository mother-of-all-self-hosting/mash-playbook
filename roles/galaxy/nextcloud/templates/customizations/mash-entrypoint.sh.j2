#!/usr/bin/env bash
set -euo pipefail

: "${PHP_MEMORY_LIMIT:=1024M}"
: "${PHP_UPLOAD_LIMIT:=2048M}"
: "${PHP_MAX_EXECUTION_TIME:=3600}"

tmpdir=/tmp/php-overrides
mkdir -p "$tmpdir"
cat >"$tmpdir/zzz-mash-overrides.ini" <<INI
memory_limit=${PHP_MEMORY_LIMIT}
upload_max_filesize=${PHP_UPLOAD_LIMIT}
post_max_size=${PHP_UPLOAD_LIMIT}
max_execution_time=${PHP_MAX_EXECUTION_TIME}
INI

# Hand off to upstream entrypoint

# Add default CMD if none supplied (docker-php-entrypoint expects $1)
if [ "$#" -eq 0 ]; then
  set -- apache2-foreground
fi

exec /entrypoint.sh "$@"
